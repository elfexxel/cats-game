<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chruno33 & Elfexxel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #020208; font-family: 'Georgia', serif; touch-action: none; }
        #info { position: fixed; top: 20px; width: 100%; text-align: center; color: #ff00ea; font-size: 24px; z-index: 100; font-weight: bold; text-shadow: 2px 2px 4px #000; pointer-events: none; }
        #final-ui { position: fixed; inset: 0; display: none; justify-content: center; align-items: center; z-index: 200; flex-direction: column; background: rgba(0,0,0,0.6); pointer-events: none; }
        .msg-box { background: rgba(30, 0, 50, 0.9); color: #e0aaff; padding: 20px; border-radius: 20px; text-align: center; font-size: 20px; border: 2px solid #7b2cbf; margin: 10px; opacity: 0; transition: opacity 1.5s; }
        .label { position: absolute; color: white; background: rgba(0,0,0,0.6); padding: 4px 10px; border-radius: 8px; font-size: 14px; pointer-events: none; font-weight: bold; transform: translate(-50%, -150%); white-space: nowrap; }
        #overlay { position: fixed; inset: 0; background: black; color: white; display: flex; justify-content: center; align-items: center; z-index: 1000; font-size: 22px; text-align: center; }
    </style>
</head>
<body>

<div id="overlay">‚ù§Ô∏è Sevgilim ƒ∞√ßin Hazƒ±rladƒ±ƒüƒ±m Oyun... <br><br> Ba≈ülamak i√ßin dokun!</div>
<div id="info">G√ºller: <span id="count">0</span> / 33</div>

<div id="final-ui">
    <div id="b1" class="msg-box">i luv u üñ§</div>
    <div id="b2" class="msg-box">i luv u too üß°</div>
    <div id="b3" class="msg-box" style="font-size: 24px; color: #ff00ea; font-style: italic;">elfexxel'den sevgilim chruno33'e<br>üòõ</div>
</div>

<script>
let scene, camera, renderer, chruno33, elfexxel, path, snow, sea;
let roses = [];
let collected = 0;
let phase = "play";
let touch = { startY: 0, currentX: 0, currentY: 0, active: false };

function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x020208);
    scene.fog = new THREE.Fog(0x020208, 10, 60);

    camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
    
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    document.body.appendChild(renderer.domElement);

    const ambient = new THREE.AmbientLight(0xffffff, 1.8);
    scene.add(ambient);

    // KARLI PATƒ∞KA (Bittiƒüi yer deniz olacak)
    const pathGeo = new THREE.BoxGeometry(10, 0.2, 200);
    const pathMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
    path = new THREE.Mesh(pathGeo, pathMat);
    path.position.z = -100;
    scene.add(path);

    // DENƒ∞Z (Patikanƒ±n tam bittiƒüi yerden ba≈ülar)
    const seaGeo = new THREE.PlaneGeometry(400, 400);
    const seaMat = new THREE.MeshStandardMaterial({ color: 0x001133, transparent: true, opacity: 0.8 });
    sea = new THREE.Mesh(seaGeo, seaMat);
    sea.rotation.x = -Math.PI / 2;
    sea.position.set(0, -0.5, -300);
    scene.add(sea);

    // KEDƒ∞LER
    function createCat(color, eyeColor, name) {
        const group = new THREE.Group();
        const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.4, 0.6, 4, 8), new THREE.MeshStandardMaterial({color: color}));
        body.rotation.x = Math.PI / 2;
        group.add(body);
        const head = new THREE.Mesh(new THREE.SphereGeometry(0.45), new THREE.MeshStandardMaterial({color: color}));
        head.position.set(0, 0.5, 0.5);
        group.add(head);
        const eyeGeo = new THREE.SphereGeometry(0.08);
        const eyeMat = new THREE.MeshBasicMaterial({color: eyeColor});
        const e1 = new THREE.Mesh(eyeGeo, eyeMat); e1.position.set(0.15, 0.6, 0.85);
        const e2 = new THREE.Mesh(eyeGeo, eyeMat); e2.position.set(-0.15, 0.6, 0.85);
        group.add(e1, e2);
        
        const el = document.createElement('div');
        el.className = 'label';
        el.textContent = name;
        document.body.appendChild(el);
        group.userData.label = el;
        return group;
    }

    chruno33 = createCat(0xffa500, 0x8b4513, "chruno33");
    elfexxel = createCat(0x0a0a0a, 0x00ff00, "elfexxel");
    
    // Elfexxel patikanƒ±n bittiƒüi deniz kenarƒ±nda bekliyor
    elfexxel.position.set(0, 0, -202); 
    scene.add(chruno33, elfexxel);

    // G√úLLER (Sadece yerde ve patika √ºzerinde)
    const rColors = [0x800080, 0xff0000, 0x0a0a0a];
    for(let i=0; i<33; i++) {
        const rose = new THREE.Mesh(new THREE.SphereGeometry(0.25), new THREE.MeshStandardMaterial({color: rColors[i%3]}));
        // X: -4 ile 4 arasƒ± (patika i√ßi), Y: 0.3 (yerde), Z: -10 ile -190 arasƒ±
        rose.position.set((Math.random()-0.5)*8, 0.3, -i*5.5 - 10);
        scene.add(rose);
        roses.push(rose);
    }

    // Kar Yaƒüƒ±≈üƒ±
    const snowGeo = new THREE.BufferGeometry();
    const snowPos = new Float32Array(1500 * 3);
    for(let i=0; i<1500*3; i++) snowPos[i] = (Math.random()-0.5)*100;
    snowGeo.setAttribute('position', new THREE.BufferAttribute(snowPos, 3));
    snow = new THREE.Points(snowGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.15}));
    scene.add(snow);

    // KONTROLLER (ƒ∞leri-Geri s√ºr√ºkleme)
    window.addEventListener('touchstart', (e) => { 
        touch.active = true; 
        touch.startY = e.touches[0].clientY;
        document.getElementById('overlay').style.display = 'none';
    });
    window.addEventListener('touchend', () => { touch.active = false; });
    window.addEventListener('touchmove', (e) => {
        touch.currentX = (e.touches[0].clientX / window.innerWidth) * 2 - 1;
        touch.currentY = (touch.startY - e.touches[0].clientY) * 0.05; // S√ºr√ºkleme miktarƒ±
    });

    animate();
}

function animate() {
    requestAnimationFrame(animate);

    if(phase === "play") {
        // Kontroll√º hareket
        if(touch.active) {
            chruno33.position.z -= touch.currentY; // ƒ∞leri-Geri
            chruno33.position.x += touch.currentX * 0.1; // Saƒü-Sol
            // Sadece patika sƒ±nƒ±rlarƒ±nda kalmasƒ± i√ßin:
            chruno33.position.x = Math.max(-4.5, Math.min(4.5, chruno33.position.x));
        }

        camera.position.lerp(new THREE.Vector3(chruno33.position.x, chruno33.position.y + 3, chruno33.position.z + 8), 0.1);
        camera.lookAt(chruno33.position);

        roses.forEach(r => {
            if(r.visible && chruno33.position.distanceTo(r.position) < 0.8) {
                r.visible = false;
                collected++;
                document.getElementById('count').innerText = collected;
            }
        });

        // Elfexxel ile kar≈üƒ±la≈üma (Patika sonu)
        if(collected >= 33 && chruno33.position.z < -200) {
            phase = "final";
            startEnding();
        }
    }

    [chruno33, elfexxel].forEach(cat => {
        const p = cat.position.clone().project(camera);
        cat.userData.label.style.left = (p.x + 1)/2 * window.innerWidth + 'px';
        cat.userData.label.style.top = (-p.y + 1)/2 * window.innerHeight + 'px';
    });

    snow.position.y -= 0.05; if(snow.position.y < -20) snow.position.y = 30;
    sea.position.y = Math.sin(Date.now()*0.001)*0.3 - 0.5;

    renderer.render(scene, camera);
}

function startEnding() {
    chruno33.position.set(0, 0, -201.2);
    // Kamera kedilere iyice yakƒ±nla≈üƒ±r (√ñp√º≈üme Zoom)
    camera.position.set(0, 0.6, -198);
    camera.lookAt(0, 0.5, -202);

    // Kedilerin g√∂zlerini kapat (Siyah yap)
    chruno33.children.forEach(c => { if(c.geometry.type === "SphereGeometry" && c.position.z > 0.8) c.material.color.set(0x000000); });
    elfexxel.children.forEach(c => { if(c.geometry.type === "SphereGeometry" && c.position.z > 0.8) c.material.color.set(0x000000); });

    document.getElementById('final-ui').style.display = 'flex';
    setTimeout(() => document.getElementById('b1').style.opacity = 1, 1000);
    setTimeout(() => document.getElementById('b2').style.opacity = 1, 3000);
    setTimeout(() => document.getElementById('b3').style.opacity = 1, 5000);
}

window.onload = init;
window.onresize = () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
};
</script>
</body>
</html>
