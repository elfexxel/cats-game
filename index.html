<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chruno33 & Elfexxel Final</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; touch-action: none; }
        #ui-layer { position: fixed; top: 15px; width: 100%; text-align: center; color: #ff00ea; font-size: 24px; z-index: 100; font-weight: bold; text-shadow: 2px 2px 4px #000; pointer-events: none; }
        .controls { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); display: grid; grid-template-columns: repeat(3, 75px); grid-gap: 15px; z-index: 500; }
        .btn { width: 75px; height: 75px; background: rgba(255,255,255,0.2); border: 2px solid white; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-size: 35px; user-select: none; }
        .up { grid-column: 2; } .left { grid-column: 1; } .down { grid-column: 2; } .right { grid-column: 3; }
        #final-ui { position: fixed; inset: 0; display: none; justify-content: center; align-items: center; z-index: 1000; flex-direction: column; }
        .msg { background: rgba(0,0,0,0.7); color: #e0aaff; padding: 15px; border-radius: 15px; font-size: 20px; margin: 10px; opacity: 0; transition: opacity 1.5s; border: 1px solid #ff00ea; text-align: center; }
        #overlay { position: fixed; inset: 0; background: black; color: white; display: flex; justify-content: center; align-items: center; z-index: 2000; font-size: 20px; text-align: center; cursor: pointer; }
    </style>
</head>
<body>

<div id="overlay" onclick="startApp()">ðŸŒ¹ BaÅŸlamak iÃ§in dokun sevgilim...</div>
<div id="ui-layer">Toplanan GÃ¼ller: <span id="count">0</span> / 33</div>

<div class="controls" id="joystick" style="display:none;">
    <div class="btn up">â–²</div>
    <div class="btn left">â—€</div>
    <div class="btn down">â–¼</div>
    <div class="btn right">â–¶</div>
</div>

<div id="final-ui">
    <div id="m1" class="msg">i luv u ðŸ–¤</div>
    <div id="m2" class="msg">i luv u too ðŸ§¡</div>
    <div id="m3" class="msg" style="color:#ff00ea; font-size: 24px;">elfexxel'den sevgilim chruno33'e ðŸ˜›</div>
</div>

<script>
let scene, camera, renderer, chruno33, elfexxel, path, sea, sand, snow, bouquet;
let roses = [];
let collected = 0;
let phase = "init";
let move = { up: false, down: false, left: false, right: false };

function startApp() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('joystick').style.display = 'grid';
    if(phase === "init") setupScene();
}

function createDetailedCat(bodyColor, eyeColor) {
    const cat = new THREE.Group();
    const mat = new THREE.MeshStandardMaterial({color: bodyColor});
    
    // GÃ¶vde
    const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.35, 0.6, 4, 8), mat);
    body.rotation.x = Math.PI / 2;
    cat.add(body);

    // Kafa
    const head = new THREE.Mesh(new THREE.SphereGeometry(0.4), mat);
    head.position.set(0, 0.5, 0.4);
    cat.add(head);

    // Kulaklar
    const earGeo = new THREE.ConeGeometry(0.12, 0.25, 4);
    const earL = new THREE.Mesh(earGeo, mat); earL.position.set(0.18, 0.9, 0.4);
    const earR = new THREE.Mesh(earGeo, mat); earR.position.set(-0.18, 0.9, 0.4);
    cat.add(earL, earR);

    // GÃ¶zler
    const eyeGeo = new THREE.SphereGeometry(0.07);
    const eyeMat = new THREE.MeshBasicMaterial({color: eyeColor});
    const eL = new THREE.Mesh(eyeGeo, eyeMat); eL.position.set(0.12, 0.6, 0.75);
    const eR = new THREE.Mesh(eyeGeo, eyeMat); eR.position.set(-0.12, 0.6, 0.75);
    cat.add(eL, eR);

    // Burun (KÃ¼Ã§Ã¼k pembe)
    const nose = new THREE.Mesh(new THREE.SphereGeometry(0.04), new THREE.MeshBasicMaterial({color: 0xffaaaa}));
    nose.position.set(0, 0.5, 0.82);
    cat.add(nose);

    // Kollar (Ã–n Patiler)
    const armGeo = new THREE.CapsuleGeometry(0.08, 0.4);
    const armL = new THREE.Mesh(armGeo, mat); armL.position.set(0.25, 0, 0.4);
    const armR = new THREE.Mesh(armGeo, mat); armR.position.set(-0.25, 0, 0.4);
    cat.add(armL, armR);

    // Bacaklar (Arka Patiler)
    const legL = new THREE.Mesh(armGeo, mat); legL.position.set(0.2, -0.3, -0.2);
    const legR = new THREE.Mesh(armGeo, mat); legR.position.set(-0.2, -0.3, -0.2);
    cat.add(legL, legR);

    // Kuyruk
    const tail = new THREE.Mesh(new THREE.CapsuleGeometry(0.06, 0.6), mat);
    tail.position.set(0, 0.2, -0.6);
    tail.rotation.x = -Math.PI/4;
    cat.add(tail);

    return cat;
}

function setupScene() {
    phase = "play";
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x020205);
    scene.fog = new THREE.Fog(0x020205, 5, 50);

    camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 1000);
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    scene.add(new THREE.AmbientLight(0xffffff, 2));

    path = new THREE.Mesh(new THREE.BoxGeometry(10, 0.4, 250), new THREE.MeshStandardMaterial({color: 0xffffff}));
    path.position.set(0, -0.4, -120);
    scene.add(path);

    chruno33 = createDetailedCat(0xffa500, 0x3d2b1f); // Turuncu, Kahve gÃ¶z
    elfexxel = createDetailedCat(0x111111, 0x00ff00); // Siyah, YeÅŸil gÃ¶z
    elfexxel.visible = false;
    scene.add(chruno33, elfexxel);

    // Buket
    bouquet = new THREE.Group();
    for(let i=0; i<10; i++) {
        const f = new THREE.Mesh(new THREE.SphereGeometry(0.1), new THREE.MeshBasicMaterial({color: 0xff0000}));
        f.position.set(Math.random()*0.3, Math.random()*0.3, 0);
        bouquet.add(f);
    }
    bouquet.visible = false;
    scene.add(bouquet);

    for(let i=0; i<35; i++) {
        const r = new THREE.Mesh(new THREE.SphereGeometry(0.28), new THREE.MeshStandardMaterial({color: 0xff0000}));
        r.position.set((Math.random()-0.5)*8, 0, -i*6 - 20);
        scene.add(r); roses.push(r);
    }

    const sGeo = new THREE.BufferGeometry();
    const sPos = new Float32Array(2000 * 3);
    for(let i=0; i<6000; i++) sPos[i] = (Math.random()-0.5)*100;
    sGeo.setAttribute('position', new THREE.BufferAttribute(sPos, 3));
    snow = new THREE.Points(sGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.1}));
    scene.add(snow);

    const setupBtn = (id, k) => {
        const el = document.querySelector('.'+id);
        el.ontouchstart = (e) => { e.preventDefault(); move[k] = true; };
        el.ontouchend = (e) => { e.preventDefault(); move[k] = false; };
    };
    setupBtn('up', 'up'); setupBtn('down', 'down'); setupBtn('left', 'left'); setupBtn('right', 'right');

    animate();
}

function animate() {
    requestAnimationFrame(animate);
    if(phase === "play") {
        const s = 0.18;
        if(move.up) chruno33.position.z -= s;
        if(move.down) chruno33.position.z += s;
        if(move.left) chruno33.position.x -= s;
        if(move.right) chruno33.position.x += s;

        chruno33.position.x = Math.max(-4.5, Math.min(4.5, chruno33.position.x));
        chruno33.position.z = Math.max(-240, Math.min(5, chruno33.position.z));

        camera.position.lerp(new THREE.Vector3(chruno33.position.x, 3.5, chruno33.position.z + 8), 0.1);
        camera.lookAt(chruno33.position);

        roses.forEach(r => {
            if(r.visible && chruno33.position.distanceTo(r.position) < 1) {
                r.visible = false; collected++;
                document.getElementById('count').innerText = Math.min(33, collected);
            }
        });

        if(collected >= 33 && chruno33.position.z < -230) {
            phase = "final";
            triggerFinal();
        }
    } else if(phase === "final") {
        if(sea) sea.position.y = Math.sin(Date.now()*0.001)*0.3 - 0.4;
    }
    if(snow) snow.position.y -= 0.05; if(snow && snow.position.y < -20) snow.position.y = 20;
    renderer.render(scene, camera);
}

function triggerFinal() {
    document.getElementById('joystick').style.display = 'none';
    path.visible = false; roses.forEach(r => r.visible = false);
    
    // KUM
    sand = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({color: 0xc2b280}));
    sand.rotation.x = -Math.PI/2; sand.position.set(0, -0.5, -300);
    scene.add(sand);

    // DENÄ°Z (Arka planda dalgalÄ±)
    sea = new THREE.Mesh(new THREE.PlaneGeometry(300, 150), new THREE.MeshStandardMaterial({color: 0x001a33, transparent: true, opacity: 0.8}));
    sea.rotation.x = -Math.PI/2; sea.position.set(0, -0.4, -380);
    scene.add(sea);

    chruno33.position.set(1.5, 0, -300);
    elfexxel.position.set(-1.5, 0, -300);
    elfexxel.visible = true;
    elfexxel.rotation.y = Math.PI / 2;
    chruno33.rotation.y = -Math.PI / 2;

    camera.position.set(0, 2, -288);
    camera.lookAt(0, 0, -300);

    // SarÄ±lma ve Ã‡iÃ§ek Verme Hareketi
    let walk = setInterval(() => {
        chruno33.position.x -= 0.03;
        elfexxel.position.x += 0.03;
        if(chruno33.position.x <= 0.5) {
            clearInterval(walk);
            bouquet.visible = true;
            bouquet.position.set(0, 0.3, -299.5);
            
            // SarÄ±lma: KollarÄ± kaldÄ±r
            chruno33.children[7].rotation.z = 1.2; // SaÄŸ kol
            elfexxel.children[7].rotation.z = -1.2; // Sol kol

            document.getElementById('final-ui').style.display = 'flex';
            setTimeout(() => document.getElementById('m1').style.opacity = 1, 1000);
            setTimeout(() => document.getElementById('m2').style.opacity = 1, 3000);
            setTimeout(() => document.getElementById('m3').style.opacity = 1, 5500);
        }
    }, 50);
}
</script>
</body>
</html>
