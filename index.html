<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chruno33 & Elfexxel</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Dancing Script', cursive; }
        #ui-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #counter { position: absolute; top: 20px; left: 20px; color: white; font-size: 28px; text-shadow: 2px 2px #ff00ea; pointer-events: auto; }
        #love-message { 
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            color: #8a2be2; font-size: 35px; text-align: center; display: none;
            background: rgba(0,0,0,0.8); padding: 30px; border-radius: 20px; border: 2px solid #000;
            text-shadow: 0 0 10px #000; width: 80%;
        }
        .speech-bubble {
            position: absolute; background: white; border-radius: 15px; padding: 10px;
            font-family: Arial, sans-serif; font-weight: bold; display: none;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
</head>
<body>

<div id="ui-layer">
    <div id="counter">Toplanan GÃ¼ller: 0 / 33</div>
    <div id="love-message"></div>
    <div id="bubble-black" class="speech-bubble">i luv u</div>
    <div id="bubble-orange" class="speech-bubble">i luv u too</div>
</div>

<script type="module">
import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

// --- KURULUM ---
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x020205);
scene.fog = new THREE.FogExp2(0x020205, 0.04);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
document.body.appendChild(renderer.domElement);

// --- IÅžIKLAR ---
const light = new THREE.PointLight(0xffffff, 1, 100);
light.position.set(0, 10, 10);
scene.add(light, new THREE.AmbientLight(0x404040, 1.5));

// --- KARLI YOL VE ORMAN ---
const pathWidth = 10;
const pathLength = 200;
const floorGeo = new THREE.PlaneGeometry(pathWidth, pathLength);
const floorMat = new THREE.MeshStandardMaterial({ color: 0xe0e0e0 }); // KarlÄ± yol
const floor = new THREE.Mesh(floorGeo, floorMat);
floor.rotation.x = -Math.PI / 2;
scene.add(floor);

// AÄŸaÃ§lar (Yol kenarÄ±na karlÄ± Ã§amlar)
for(let i=0; i<40; i++) {
    const treeGroup = new THREE.Group();
    const cone = new THREE.Mesh(new THREE.ConeGeometry(1, 4, 8), new THREE.MeshStandardMaterial({color: 0x2d4c2d}));
    cone.position.y = 2;
    treeGroup.add(cone);
    treeGroup.position.set(i % 2 === 0 ? 7 : -7, 0, -i * 5);
    scene.add(treeGroup);
}

// --- DENÄ°Z (Yolun Sonunda) ---
const seaGeo = new THREE.PlaneGeometry(100, 100);
const seaMat = new THREE.MeshStandardMaterial({ color: 0x001a33, transparent: true, opacity: 0.8 });
const sea = new THREE.Mesh(seaGeo, seaMat);
sea.rotation.x = -Math.PI / 2;
sea.position.set(0, -0.1, -140);
scene.add(sea);

// --- KEDÄ°LER (Daha Belirgin) ---
function createCat(color, eyeColor) {
    const group = new THREE.Group();
    const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.3, 0.5, 4, 8), new THREE.MeshStandardMaterial({color: color}));
    body.rotation.x = Math.PI / 2;
    group.add(body);
    const head = new THREE.Mesh(new THREE.SphereGeometry(0.3), new THREE.MeshStandardMaterial({color: color}));
    head.position.set(0, 0.4, 0.4);
    group.add(head);
    const eyeGeo = new THREE.SphereGeometry(0.06);
    const eyeMat = new THREE.MeshBasicMaterial({color: eyeColor});
    const e1 = new THREE.Mesh(eyeGeo, eyeMat); e1.position.set(0.12, 0.5, 0.6);
    const e2 = new THREE.Mesh(eyeGeo, eyeMat); e2.position.set(-0.12, 0.5, 0.6);
    group.add(e1, e2);
    return group;
}

const chruno33 = createCat(0xff8c00, 0x5d4037); // Turuncu kedi, kahve gÃ¶z
scene.add(chruno33);

const elfexxel = createCat(0x050505, 0x00ff00); // Siyah kedi, yeÅŸil gÃ¶z
elfexxel.position.set(0, 0, -110);
elfexxel.rotation.y = Math.PI; 
scene.add(elfexxel);

// --- GÃœLLER ---
const roses = [];
const colors = [0x800080, 0xff0000, 0x000000];
for(let i=0; i<33; i++) {
    const rose = new THREE.Group();
    const flower = new THREE.Mesh(new THREE.SphereGeometry(0.2), new THREE.MeshStandardMaterial({color: colors[i%3]}));
    rose.add(flower);
    rose.position.set((Math.random()-0.5)*8, 0.3, -i * 3 - 10);
    scene.add(rose);
    roses.push(rose);
}

// --- KONTROLLER (Mobil Uyumlu) ---
let touchX = 0, touchY = 0;
let isMoving = false;

window.addEventListener('touchstart', e => { isMoving = true; });
window.addEventListener('touchend', e => { isMoving = false; });
window.addEventListener('touchmove', e => {
    touchX = (e.touches[0].clientX / window.innerWidth) * 2 - 1;
    touchY = (e.touches[0].clientY / window.innerHeight) * 2 - 1;
});

// --- OYUN MANTIÄžI ---
let collected = 0;
let phase = "play"; // play, final

function animate() {
    requestAnimationFrame(animate);

    if(phase === "play") {
        if(isMoving) {
            chruno33.position.z -= 0.2; // Ä°leri git
            chruno33.position.x += touchX * 0.1; // SaÄŸ-Sol
            chruno33.position.y = Math.max(0, chruno33.position.y - touchY * 0.1); // YukarÄ±-AÅŸaÄŸÄ±
        }

        camera.position.lerp(new THREE.Vector3(chruno33.position.x, chruno33.position.y + 3, chruno33.position.z + 6), 0.1);
        camera.lookAt(chruno33.position);

        // GÃ¼l toplama
        roses.forEach(r => {
            if(r.visible && chruno33.position.distanceTo(r.position) < 0.8) {
                r.visible = false;
                collected++;
                document.getElementById('counter').innerText = `Toplanan GÃ¼ller: ${collected} / 33`;
            }
        });

        // Final tetikleme
        if(collected >= 33 && chruno33.position.z < -105) {
            phase = "final";
            startEnding();
        }
    } else if(phase === "final") {
        // Deniz dalgalanma efekti
        sea.position.y = Math.sin(Date.now() * 0.002) * 0.1;
    }

    renderer.render(scene, camera);
}

function startEnding() {
    // Kediler birbirine yaklaÅŸÄ±r
    chruno33.position.set(0, 0, -109.2);
    
    // Kamera Zoom
    camera.position.set(0, 0.8, -107);
    camera.lookAt(0, 0.5, -110);

    setTimeout(() => {
        document.getElementById('bubble-black').style.display = "block";
        document.getElementById('bubble-black').style.left = "60%";
        document.getElementById('bubble-black').style.top = "30%";
        
        setTimeout(() => {
            document.getElementById('bubble-orange').style.display = "block";
            document.getElementById('bubble-orange').style.left = "20%";
            document.getElementById('bubble-orange').style.top = "30%";
            
            setTimeout(() => {
                const loveMsg = document.getElementById('love-message');
                loveMsg.style.display = "block";
                loveMsg.innerHTML = "elfexxel'den sevgilim chruno33'e <br><br> ðŸ˜›";
            }, 2000);
        }, 2000);
    }, 1000);
}

animate();
</script>
</body>
</html>
