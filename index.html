<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chruno33 & Elfexxel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; touch-action: none; }
        #ui { position: fixed; top: 20px; width: 100%; text-align: center; color: #ff00ea; font-size: 26px; z-index: 100; font-weight: bold; text-shadow: 2px 2px 5px #000; pointer-events: none; }
        .controls { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); display: grid; grid-template-columns: repeat(3, 80px); grid-gap: 15px; z-index: 500; }
        .btn { width: 80px; height: 80px; background: rgba(255,255,255,0.2); border: 3px solid white; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-size: 40px; user-select: none; }
        #final-ui { position: fixed; inset: 0; display: none; justify-content: center; align-items: center; z-index: 1000; flex-direction: column; background: rgba(0,0,0,0.3); }
        .msg { background: rgba(0,0,0,0.7); color: white; padding: 15px 25px; border-radius: 20px; font-size: 24px; margin: 10px; opacity: 0; transition: opacity 1.5s; border: 2px solid #ff00ea; }
        #overlay { position: fixed; inset: 0; background: black; color: white; display: flex; justify-content: center; align-items: center; z-index: 2000; font-size: 22px; cursor: pointer; }
    </style>
</head>
<body>

<div id="overlay" onclick="startApp()">üêæ Oyunu Ba≈ülatmak ƒ∞√ßin Dokun üêæ</div>
<div id="ui">Toplanan G√ºller: <span id="count">0</span> / 33</div>

<div class="controls" id="btns" style="display:none;">
    <div style="grid-column:2" class="btn" id="up">‚ñ≤</div>
    <div style="grid-column:1" class="btn" id="left">‚óÄ</div>
    <div style="grid-column:2" class="btn" id="down">‚ñº</div>
    <div style="grid-column:3" class="btn" id="right">‚ñ∂</div>
</div>

<div id="final-ui">
    <div id="m1" class="msg">i luv u üñ§</div>
    <div id="m2" class="msg">i luv u too üß°</div>
    <div id="m3" class="msg" style="color:#ff00ea; font-size: 28px;">elfexxel'den sevgilim chruno33'e üòõ</div>
</div>

<script>
let scene, camera, renderer, chruno33, elfexxel, path, sea, sand, bouquet;
let roses = [], collected = 0, phase = "init", move = {up:0, down:0, left:0, right:0};

function startApp() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('btns').style.display = 'grid';
    if(phase === "init") initGame();
}

function createDetailedCat(color) {
    const cat = new THREE.Group();
    const mat = new THREE.MeshStandardMaterial({color: color});
    
    // G√∂vde
    const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.3, 0.6, 4, 8), mat);
    body.rotation.x = Math.PI/2;
    cat.add(body);
    
    // Kafa
    const head = new THREE.Mesh(new THREE.SphereGeometry(0.35), mat);
    head.position.set(0, 0.4, 0.4);
    cat.add(head);
    
    // Kulaklar
    const earGeo = new THREE.ConeGeometry(0.1, 0.2, 4);
    const e1 = new THREE.Mesh(earGeo, mat); e1.position.set(0.15, 0.7, 0.4); cat.add(e1);
    const e2 = new THREE.Mesh(earGeo, mat); e2.position.set(-0.15, 0.7, 0.4); cat.add(e2);
    
    // Bacaklar
    const legGeo = new THREE.CylinderGeometry(0.08, 0.08, 0.4);
    for(let i=0; i<4; i++) {
        const leg = new THREE.Mesh(legGeo, mat);
        leg.position.set(i<2?0.2:-0.2, -0.3, i%2==0?0.2:-0.2);
        cat.add(leg);
    }
    
    // Kuyruk
    const tail = new THREE.Mesh(new THREE.CapsuleGeometry(0.05, 0.5, 4, 8), mat);
    tail.position.set(0, 0.1, -0.4);
    tail.rotation.x = -Math.PI/4;
    cat.add(tail);
    
    // G√∂zler
    const eye = new THREE.Mesh(new THREE.SphereGeometry(0.05), new THREE.MeshBasicMaterial({color: 0x00ff00}));
    const eyeR = eye.clone(); eye.position.set(0.12, 0.45, 0.7); eyeR.position.set(-0.12, 0.45, 0.7);
    cat.add(eye, eyeR);

    return cat;
}

function initGame() {
    phase = "play";
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x050505);
    camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 1000);
    renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    
    scene.add(new THREE.AmbientLight(0xffffff, 1.5));
    const sun = new THREE.DirectionalLight(0xffffff, 1);
    sun.position.set(5, 10, 5); scene.add(sun);

    // PATƒ∞KA
    path = new THREE.Mesh(new THREE.BoxGeometry(8, 0.2, 200), new THREE.MeshStandardMaterial({color: 0xeeeeee}));
    path.position.set(0, -0.5, -95);
    scene.add(path);

    chruno33 = createDetailedCat(0xffa500);
    elfexxel = createDetailedCat(0x111111);
    elfexxel.visible = false;
    scene.add(chruno33, elfexxel);

    // G√úLLER (Yolun ortasƒ±na dizili)
    const gCols = [0xff0000, 0x800080, 0x111111];
    for(let i=0; i<40; i++) {
        const r = new THREE.Group();
        const flower = new THREE.Mesh(new THREE.SphereGeometry(0.25), new THREE.MeshStandardMaterial({color: gCols[i%3]}));
        const stem = new THREE.Mesh(new THREE.CylinderGeometry(0.03, 0.03, 0.5), new THREE.MeshStandardMaterial({color: 0x00ff00}));
        flower.position.y = 0.3; r.add(flower, stem);
        r.position.set((Math.random()-0.5)*5, -0.2, -i*4.5 - 15);
        scene.add(r); roses.push(r);
    }

    // BUTON KONTROLLERƒ∞
    const setupBtn = (id, key) => {
        const el = document.getElementById(id);
        el.ontouchstart = () => move[key] = 1; el.ontouchend = () => move[key] = 0;
    };
    setupBtn('up', 'up'); setupBtn('down', 'down'); setupBtn('left', 'left'); setupBtn('right', 'right');

    animate();
}

function animate() {
    requestAnimationFrame(animate);
    if(phase === "play") {
        const s = 0.18;
        if(move.up) chruno33.position.z -= s;
        if(move.down) chruno33.position.z += s;
        if(move.left) chruno33.position.x -= s;
        if(move.right) chruno33.position.x += s;

        chruno33.position.x = Math.max(-3.5, Math.min(3.5, chruno33.position.x));
        chruno33.position.z = Math.max(-190, Math.min(5, chruno33.position.z));

        camera.position.lerp(new THREE.Vector3(chruno33.position.x, 3, chruno33.position.z + 7), 0.1);
        camera.lookAt(chruno33.position);

        roses.forEach(r => {
            if(r.visible && chruno33.position.distanceTo(r.position) < 0.8) {
                r.visible = false; collected++;
                document.getElementById('count').innerText = Math.min(33, collected);
            }
        });

        if(collected >= 33 && chruno33.position.z < -185) startFinal();
    } else if (phase === "final") {
        camera.position.lerp(new THREE.Vector3(0, 1.5, -294), 0.03);
        camera.lookAt(0, 1, -300);
        if(sea) sea.position.y = Math.sin(Date.now()*0.002)*0.1 - 0.2;
    }
    renderer.render(scene, camera);
}

function startFinal() {
    phase = "final";
    document.getElementById('btns').style.display = 'none';
    path.visible = false; roses.forEach(r => r.visible = false);

    sand = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({color: 0xd2b48c}));
    sand.rotation.x = -Math.PI/2; sand.position.set(0, -0.5, -300);
    scene.add(sand);

    sea = new THREE.Mesh(new THREE.PlaneGeometry(200, 100), new THREE.MeshStandardMaterial({color: 0x00ced1, transparent: true, opacity: 0.8}));
    sea.rotation.x = -Math.PI/2; sea.position.set(0, -0.3, -340);
    scene.add(sea);

    chruno33.position.set(0, -0.1, -294);
    elfexxel.position.set(0, -0.1, -306);
    elfexxel.visible = true; elfexxel.rotation.y = Math.PI;

    // Y√úR√úME VE SARILMA
    let walk = setInterval(() => {
        chruno33.position.z -= 0.04; elfexxel.position.z += 0.04;
        if(chruno33.position.z <= -299.2) {
            clearInterval(walk);
            // ≈ûaha kalkma / Sarƒ±lma
            chruno33.rotation.x = -Math.PI/5; elfexxel.rotation.x = -Math.PI/5;
            chruno33.position.y = 0.4; elfexxel.position.y = 0.4;
            
            // Buket (Turuncu kedinin yanƒ±nda belirsin)
            bouquet = new THREE.Group();
            for(let i=0; i<10; i++) {
                const f = new THREE.Mesh(new THREE.SphereGeometry(0.1), new THREE.MeshBasicMaterial({color: i%2?0xff0000:0x800080}));
                f.position.set(Math.random()*0.3, Math.random()*0.3, 0); bouquet.add(f);
            }
            bouquet.position.set(0.4, 1, -300); scene.add(bouquet);

            document.getElementById('final-ui').style.display = 'flex';
            setTimeout(()=> document.getElementById('m1').style.opacity=1, 1000);
            setTimeout(()=> document.getElementById('m2').style.opacity=1, 3000);
            setTimeout(()=> document.getElementById('m3').style.opacity=1, 5000);
        }
    }, 50);
}
</script>
</body>
</html>
