<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chruno33 & Elfexxel</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000205; font-family: 'Comic Sans MS', cursive; }
        #info { position: fixed; top: 10px; width: 100%; text-align: center; color: white; font-size: 20px; z-index: 10; text-shadow: 2px 2px 5px #ff00ea; }
        #final-ui { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; justify-content: center; align-items: center; z-index: 20; flex-direction: column; pointer-events: none; }
        .msg-box { background: rgba(0,0,0,0.7); color: #c084fc; padding: 20px; border-radius: 20px; text-align: center; font-size: 24px; border: 2px solid #581c87; margin: 10px; opacity: 0; transition: opacity 1s; }
        .label { position: absolute; color: white; background: rgba(0,0,0,0.5); padding: 2px 8px; border-radius: 5px; font-size: 12px; pointer-events: none; transform: translate(-50%, -150%); }
    </style>
</head>
<body>

<div id="info">GÃ¼ller: <span id="count">0</span> / 33</div>

<div id="final-ui">
    <div id="b1" class="msg-box">i luv u ðŸ–¤</div>
    <div id="b2" class="msg-box">i luv u too ðŸ§¡</div>
    <div id="b3" class="msg-box" style="font-size: 30px; color: #ff00ea;">elfexxel'den sevgilim chruno33'e<br>ðŸ˜›</div>
</div>

<script type="module">
import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

// SAHNE AYARLARI
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x020208); // Gece
scene.fog = new THREE.Fog(0x020208, 1, 40);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// IÅžIKLAR
const ambient = new THREE.AmbientLight(0xffffff, 0.6);
scene.add(ambient);
const moon = new THREE.PointLight(0x80adff, 1.5);
moon.position.set(0, 10, -50);
scene.add(moon);

// KARLI YOL
const pathGeo = new THREE.PlaneGeometry(12, 200);
const pathMat = new THREE.MeshStandardMaterial({ color: 0xffffff }); // Bembeyaz kar
const path = new THREE.Mesh(pathGeo, pathMat);
path.rotation.x = -Math.PI / 2;
scene.add(path);

// DENÄ°Z (Yolun Sonunda)
const seaGeo = new THREE.PlaneGeometry(200, 200, 20, 20);
const seaMat = new THREE.MeshStandardMaterial({ color: 0x001133, transparent: true, opacity: 0.8 });
const sea = new THREE.Mesh(seaGeo, seaMat);
sea.rotation.x = -Math.PI / 2;
sea.position.z = -150;
scene.add(sea);

// KAR TANELERÄ°
const snowCount = 1000;
const snowGeo = new THREE.BufferGeometry();
const snowPos = new Float32Array(snowCount * 3);
for(let i=0; i<snowCount*3; i++) snowPos[i] = (Math.random()-0.5)*50;
snowGeo.setAttribute('position', new THREE.BufferAttribute(snowPos, 3));
const snow = new THREE.Points(snowGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.1}));
scene.add(snow);

// KEDÄ° YAPICI (GÃ¶zler ve Ä°sim Dahil)
function createCat(catColor, eyeColor, name) {
    const group = new THREE.Group();
    // VÃ¼cut
    const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.3, 0.5, 4, 8), new THREE.MeshStandardMaterial({color: catColor}));
    body.rotation.x = Math.PI / 2;
    group.add(body);
    // Kafa
    const head = new THREE.Mesh(new THREE.SphereGeometry(0.35, 16, 16), new THREE.MeshStandardMaterial({color: catColor}));
    head.position.set(0, 0.4, 0.4);
    group.add(head);
    // GÃ¶zler
    const eyeGeo = new THREE.SphereGeometry(0.06);
    const eyeMat = new THREE.MeshBasicMaterial({color: eyeColor});
    const e1 = new THREE.Mesh(eyeGeo, eyeMat); e1.position.set(0.12, 0.5, 0.65);
    const e2 = new THREE.Mesh(eyeGeo, eyeMat); e2.position.set(-0.12, 0.5, 0.65);
    group.add(e1, e2);
    
    // Ä°sim Etiketi (HTML)
    const el = document.createElement('div');
    el.className = 'label';
    el.textContent = name;
    document.body.appendChild(el);
    group.userData.label = el;

    return group;
}

const chruno33 = createCat(0xffa500, 0x8b4513, "chruno33"); // Turuncu
const elfexxel = createCat(0x111111, 0x00ff00, "elfexxel"); // Siyah
elfexxel.position.set(0, 0, -110);
scene.add(chruno33, elfexxel);

// GÃœLLER (33 Adet)
const roses = [];
const rColors = [0x800080, 0xff0000, 0x000000];
for(let i=0; i<33; i++) {
    const r = new THREE.Mesh(new THREE.SphereGeometry(0.2), new THREE.MeshStandardMaterial({color: rColors[i%3]}));
    r.position.set((Math.random()-0.5)*10, Math.random()*2, -i*3 - 10);
    scene.add(r);
    roses.push(r);
}

// KONTROLLER
let touch = { x: 0, y: 0, active: false };
window.addEventListener('touchstart', (e) => { touch.active = true; });
window.addEventListener('touchend', () => { touch.active = false; });
window.addEventListener('touchmove', (e) => {
    touch.x = (e.touches[0].clientX / window.innerWidth) * 2 - 1;
    touch.y = -(e.touches[0].clientY / window.innerHeight) * 2 + 1;
});

let collected = 0;
let phase = "play";

function animate() {
    requestAnimationFrame(animate);

    if(phase === "play") {
        // Hareket (Ä°leri otomatik, saÄŸ-sol-yukarÄ±-aÅŸaÄŸÄ± joystick ile)
        chruno33.position.z -= 0.15;
        if(touch.active) {
            chruno33.position.x += touch.x * 0.15;
            chruno33.position.y += (touch.y * 0.15);
            chruno33.position.y = Math.max(0, Math.min(chruno33.position.y, 5)); // Yerden altÄ±na girmesin
        }

        camera.position.lerp(new THREE.Vector3(chruno33.position.x, chruno33.position.y + 2.5, chruno33.position.z + 6), 0.1);
        camera.lookAt(chruno33.position);

        // GÃ¼l toplama
        roses.forEach(r => {
            if(r.visible && chruno33.position.distanceTo(r.position) < 0.8) {
                r.visible = false;
                collected++;
                document.getElementById('count').innerText = collected;
            }
        });

        // BitiÅŸ kontrol
        if(collected >= 33 && chruno33.position.z < -105) {
            phase = "final";
            startEnding();
        }
    }

    // Ä°sim etiketlerini gÃ¼ncelle
    [chruno33, elfexxel].forEach(cat => {
        const p = cat.position.clone().project(camera);
        cat.userData.label.style.left = (p.x + 1)/2 * window.innerWidth + 'px';
        cat.userData.label.style.top = (-p.y + 1)/2 * window.innerHeight + 'px';
    });

    // Kar ve Deniz hareketi
    snow.position.y -= 0.05; if(snow.position.y < -10) snow.position.y = 10;
    sea.geometry.attributes.position.array.forEach((v, i) => {
        if(i % 3 === 2) sea.geometry.attributes.position.array[i] += Math.sin(Date.now()*0.001 + i)*0.01;
    });
    sea.geometry.attributes.position.needsUpdate = true;

    renderer.render(scene, camera);
}

function startEnding() {
    // Kedileri birleÅŸtir
    chruno33.position.set(0, 0, -109.3);
    elfexxel.position.set(0, 0, -110);
    
    // Kedilerin gÃ¶zlerini kapat (Siyah yap)
    chruno33.children.filter(c => c.geometry.type === "SphereGeometry" && c.scale.x < 0.1).forEach(e => e.material.color.set(0x000000));

    // Kamera Zoom
    camera.position.set(0, 0.5, -107.5);
    camera.lookAt(0, 0.5, -110);

    // Mesajlar
    document.getElementById('final-ui').style.display = 'flex';
    setTimeout(() => document.getElementById('b1').style.opacity = 1, 1000);
    setTimeout(() => document.getElementById('b2').style.opacity = 1, 3000);
    setTimeout(() => document.getElementById('b3').style.opacity = 1, 5000);
}

animate();
</script>
</body>
</html>
