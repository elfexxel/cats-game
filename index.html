<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chruno33 & Elfexxel</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial', sans-serif; touch-action: none; }
        
        /* OYUN UI */
        #ui-layer { position: fixed; top: 15px; width: 100%; text-align: center; color: #ff00ea; font-size: 22px; z-index: 100; font-weight: bold; text-shadow: 2px 2px 4px #000; pointer-events: none; }
        
        /* DOKUNMATƒ∞K TU≈ûLAR */
        .controls { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); display: grid; grid-template-columns: repeat(3, 75px); grid-gap: 12px; z-index: 500; }
        .btn { width: 75px; height: 75px; background: rgba(255,255,255,0.15); border: 2px solid white; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-size: 32px; user-select: none; -webkit-tap-highlight-color: transparent; }
        .up { grid-column: 2; } .left { grid-column: 1; } .down { grid-column: 2; } .right { grid-column: 3; }

        /* Sƒ∞NEMATƒ∞K MESAJLAR */
        #final-ui { position: fixed; inset: 0; display: none; justify-content: center; align-items: center; z-index: 1000; flex-direction: column; background: transparent; }
        .msg { background: rgba(0,0,0,0.6); color: #e0aaff; padding: 15px 25px; border-radius: 20px; font-size: 22px; margin: 10px; opacity: 0; transition: opacity 1.5s; border: 1px solid #ff00ea; text-align: center; }
        
        /* EKRAN GE√áƒ∞≈ûLERƒ∞ */
        #fade-overlay { position: fixed; inset: 0; background: black; opacity: 1; z-index: 2000; pointer-events: none; transition: opacity 2s; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; }
        .label { position: absolute; color: white; background: rgba(0,0,0,0.5); padding: 3px 10px; border-radius: 6px; font-size: 13px; transform: translate(-50%, -160%); white-space: nowrap; }
    </style>
</head>
<body>

<div id="fade-overlay">‚ù§Ô∏è Y√ºkleniyor... <br><br> (Dokun ve Ba≈üla)</div>
<div id="ui-layer">G√ºller: <span id="count">0</span> / 33</div>

<div class="controls" id="joystick">
    <div class="btn up" id="b-up">‚ñ≤</div>
    <div class="btn left" id="b-left">‚óÄ</div>
    <div class="btn down" id="b-down">‚ñº</div>
    <div class="btn right" id="b-right">‚ñ∂</div>
</div>

<div id="final-ui">
    <div id="m1" class="msg">i luv u üñ§</div>
    <div id="m2" class="msg">i luv u too üß°</div>
    <div id="m3" class="msg" style="color:#ff00ea; font-size: 26px; border-width: 2px;">elfexxel'den sevgilim chruno33'e üòõ</div>
</div>

<script>
let scene, camera, renderer, chruno33, elfexxel, path, sea, sand, snow, bouquet;
let roses = [];
let collected = 0;
let phase = "loading"; // loading, play, transition, final
let move = { up: false, down: false, left: false, right: false };

function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x020205);
    scene.fog = new THREE.Fog(0x020205, 5, 50);

    camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 1000);
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    document.body.appendChild(renderer.domElement);

    scene.add(new THREE.AmbientLight(0xffffff, 2.0));

    // 1. D√úNYA: PATƒ∞KA
    const pathGeo = new THREE.BoxGeometry(10, 0.5, 200);
    const pathMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
    path = new THREE.Mesh(pathGeo, pathMat);
    path.position.set(0, -0.25, -95);
    scene.add(path);

    // KEDƒ∞LER
    function createCat(color, eyeColor, name) {
        const g = new THREE.Group();
        const b = new THREE.Mesh(new THREE.CapsuleGeometry(0.38, 0.65, 4, 8), new THREE.MeshStandardMaterial({color: color}));
        b.rotation.x = Math.PI/2; g.add(b);
        const h = new THREE.Mesh(new THREE.SphereGeometry(0.42), new THREE.MeshStandardMaterial({color: color}));
        h.position.set(0, 0.5, 0.5); g.add(h);
        const eMat = new THREE.MeshBasicMaterial({color: eyeColor});
        const e1 = new THREE.Mesh(new THREE.SphereGeometry(0.08), eMat); e1.position.set(0.14, 0.6, 0.85);
        const e2 = new THREE.Mesh(new THREE.SphereGeometry(0.08), eMat); e2.position.set(-0.14, 0.6, 0.85);
        g.add(e1, e2);
        const div = document.createElement('div'); div.className = 'label'; div.textContent = name;
        document.body.appendChild(div); g.userData.label = div;
        return g;
    }

    chruno33 = createCat(0xffa500, 0x4a3728, "chruno33");
    elfexxel = createCat(0x0a0a0a, 0x00ff00, "elfexxel");
    elfexxel.visible = false;
    scene.add(chruno33, elfexxel);

    // BUKET
    bouquet = new THREE.Group();
    for(let i=0; i<8; i++){
        const f = new THREE.Mesh(new THREE.SphereGeometry(0.12), new THREE.MeshBasicMaterial({color: 0xff0000}));
        f.position.set(Math.random()*0.3-0.15, Math.random()*0.3, Math.random()*0.1);
        bouquet.add(f);
    }
    bouquet.visible = false;
    scene.add(bouquet);

    // G√úLLER
    const rCols = [0xff0000, 0x800080, 0x111111];
    for(let i=0; i<33; i++) {
        const r = new THREE.Mesh(new THREE.SphereGeometry(0.28), new THREE.MeshStandardMaterial({color: rCols[i%3]}));
        r.position.set((Math.random()-0.5)*8, 0.25, -i*5.5 - 20);
        scene.add(r); roses.push(r);
    }

    // KAR
    const snowGeo = new THREE.BufferGeometry();
    const snowPos = new Float32Array(2000 * 3);
    for(let i=0; i<6000; i++) snowPos[i] = (Math.random()-0.5)*100;
    snowGeo.setAttribute('position', new THREE.BufferAttribute(snowPos, 3));
    snow = new THREE.Points(snowGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.12}));
    scene.add(snow);

    // TU≈û ATAMALARI
    const setupBtn = (id, k) => {
        const el = document.getElementById(id);
        const on = (e) => { e.preventDefault(); move[k] = true; if(phase==="loading") startWorld(); };
        const off = (e) => { e.preventDefault(); move[k] = false; };
        el.addEventListener('touchstart', on); el.addEventListener('touchend', off);
        el.addEventListener('mousedown', on); el.addEventListener('mouseup', off);
    };
    setupBtn('b-up', 'up'); setupBtn('b-down', 'down');
    setupBtn('b-left', 'left'); setupBtn('b-right', 'right');

    animate();
}

function startWorld() {
    phase = "play";
    document.getElementById('fade-overlay').style.opacity = 0;
    setTimeout(() => { document.getElementById('fade-overlay').style.display = 'none'; }, 2000);
}

function animate() {
    requestAnimationFrame(animate);

    if(phase === "play") {
        const s = 0.18; 
        if(move.up) chruno33.position.z -= s;
        if(move.down) chruno33.position.z += s;
        if(move.left) chruno33.position.x -= s;
        if(move.right) chruno33.position.x += s;

        // PATƒ∞KA SINIRLARI
        chruno33.position.x = Math.max(-4.4, Math.min(4.4, chruno33.position.x));
        chruno33.position.z = Math.max(-210, Math.min(5, chruno33.position.z));
        chruno33.position.y = 0;

        camera.position.lerp(new THREE.Vector3(chruno33.position.x, 3.5, chruno33.position.z + 8), 0.1);
        camera.lookAt(chruno33.position);

        roses.forEach(r => {
            if(r.visible && chruno33.position.distanceTo(r.position) < 0.95) {
                r.visible = false; collected++;
                document.getElementById('count').innerText = collected;
            }
        });

        if(collected >= 33 && chruno33.position.z < -200) {
            phase = "transition";
            startCinematic();
        }
    } else if(phase === "final") {
        sea.position.y = Math.sin(Date.now()*0.0012)*0.25 - 0.4;
        camera.position.lerp(new THREE.Vector3(0, 0.7, -346), 0.008);
    }

    [chruno33, elfexxel].forEach(cat => {
        if(!cat.visible || phase === "loading") { cat.userData.label.style.display = 'none'; return; }
        cat.userData.label.style.display = 'block';
        const p = cat.position.clone().project(camera);
        cat.userData.label.style.left = (p.x + 1)/2 * window.innerWidth + 'px';
        cat.userData.label.style.top = (-p.y + 1)/2 * window.innerHeight + 'px';
    });

    snow.position.y -= 0.06; if(snow.position.y < -30) snow.position.y = 30;
    renderer.render(scene, camera);
}

function startCinematic() {
    const fade = document.getElementById('fade-overlay');
    fade.style.display = 'flex';
    fade.innerHTML = "";
    setTimeout(() => { fade.style.opacity = 1; }, 10);
    document.getElementById('joystick').style.display = 'none';
    document.getElementById('ui-layer').style.display = 'none';

    setTimeout(() => {
        path.visible = false;
        roses.forEach(r => r.visible = false);
        
        // 2. D√úNYA: KUM VE DENƒ∞Z
        const sandGeo = new THREE.PlaneGeometry(120, 120);
        const sandMat = new THREE.MeshStandardMaterial({color: 0xdeb887});
        sand = new THREE.Mesh(sandGeo, sandMat);
        sand.rotation.x = -Math.PI/2; sand.position.set(0, -0.1, -350);
        scene.add(sand);

        const seaGeo = new THREE.PlaneGeometry(250, 150);
        const seaMat = new THREE.MeshStandardMaterial({color: 0x002b5c, transparent: true, opacity: 0.85});
        sea = new THREE.Mesh(seaGeo, seaMat);
        sea.rotation.x = -Math.PI/2; sea.position.set(0, -0.05, -420);
        scene.add(sea);

        chruno33.position.set(0, 0, -340);
        elfexxel.position.set(0, 0, -360);
        elfexxel.visible = true;
        elfexxel.rotation.y = Math.PI;

        camera.position.set(0, 1.5, -330);
        camera.lookAt(0, 0, -350);

        fade.style.opacity = 0;
        phase = "final";

        // OTOMATƒ∞K HAREKET VE √ñP√ú≈ûME
        let walkTimer = setInterval(() => {
            chruno33.position.z -= 0.04;
            elfexxel.position.z += 0.04;
            if(chruno33.position.z <= -349.2) {
                clearInterval(walkTimer);
                bouquet.visible = true;
                bouquet.position.set(0, 0.4, -349.5);
                // G√∂zleri kapatma efekti (√ñp√º≈üme)
                [chruno33, elfexxel].forEach(cat => {
                    cat.children.forEach(c => { if(c.geometry.type==="SphereGeometry" && c.position.z > 0.7) c.material.color.set(0x000000); });
                });
                
                setTimeout(() => {
                    document.getElementById('final-ui').style.display = 'flex';
                    setTimeout(() => document.getElementById('m1').style.opacity = 1, 1000);
                    setTimeout(() => document.getElementById('m2').style.opacity = 1, 3000);
                    setTimeout(() => document.getElementById('m3').style.opacity = 1, 6000);
                }, 1000);
            }
        }, 30);
        
        setTimeout(() => { fade.style.display = 'none'; }, 2000);
    }, 2000);
}

window.onload = init;
</script>
</body>
</html>
