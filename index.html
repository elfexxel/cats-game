<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chruno33 & Elfexxel - Kusursuz Versiyon</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
    <style>
        /* Zoom ve ekran kaymasƒ±nƒ± tamamen kapatan √ßekirdek ayarlar */
        * { 
            -webkit-user-select: none; 
            user-select: none; 
            touch-action: none; 
            -webkit-tap-highlight-color: transparent; 
        }
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        
        #ui { position: fixed; top: 15px; width: 100%; text-align: center; color: #ff00ea; font-size: 22px; font-weight: bold; z-index: 100; text-shadow: 2px 2px 4px #000; pointer-events: none; }
        
        .controls { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); display: grid; grid-template-columns: repeat(3, 75px); grid-gap: 15px; z-index: 500; }
        .btn { width: 75px; height: 75px; background: rgba(255,255,255,0.2); border: 2px solid #fff; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: #fff; font-size: 30px; }
        
        #final-ui { position: fixed; inset: 0; display: none; justify-content: center; align-items: center; z-index: 1000; flex-direction: column; pointer-events: none; }
        .msg { background: rgba(0,0,0,0.8); color: #fff; padding: 15px; border-radius: 12px; margin: 10px; opacity: 0; transition: 1.5s; border: 2px solid #ff00ea; text-align: center; }
        
        #overlay { position: fixed; inset: 0; background: #000; color: #fff; display: flex; justify-content: center; align-items: center; z-index: 2000; cursor: pointer; text-align: center; font-size: 20px; }
        .label { position: absolute; color: white; background: rgba(0,0,0,0.6); padding: 3px 10px; border-radius: 6px; font-size: 14px; font-weight: bold; transform: translate(-50%, -250%); pointer-events: none; }
    </style>
</head>
<body>

<div id="overlay" onclick="startApp()">‚ù§Ô∏è T√úM HATALAR Gƒ∞DERƒ∞LDƒ∞ ‚ù§Ô∏è<br><br>(Dokun ve Ba≈üla)</div>
<div id="ui">Toplanan G√ºller: <span id="count">0</span> / 33</div>

<div class="controls" id="joy" style="display:none;">
    <div style="grid-column: 2" class="btn" id="up">‚ñ≤</div>
    <div style="grid-column: 1" class="btn" id="left">‚óÄ</div>
    <div style="grid-column: 2" class="btn" id="down">‚ñº</div>
    <div style="grid-column: 3" class="btn" id="right">‚ñ∂</div>
</div>

<div id="final-ui">
    <div id="m1" class="msg">i luv u üñ§</div>
    <div id="m2" class="msg">i luv u too üß°</div>
    <div id="m3" class="msg" style="color:#ff00ea; font-weight:bold;">elfexxel'den sevgilim chruno33'e üòõ</div>
</div>

<script>
let scene, camera, renderer, chruno33, elfexxel, path, bouquet;
let roses = [], collected = 0, phase = "init";
let keys = { up: false, down: false, left: false, right: false };

function startApp() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('joy').style.display = 'grid';
    if(phase === "init") setup();
}

function createPerfectCat(color, eyeColor, name) {
    const group = new THREE.Group();
    const mat = new THREE.MeshStandardMaterial({ color: color });

    // G√∂vde (Silindir hatasƒ±nƒ± √∂nlemek i√ßin iki k√ºre birle≈üimi)
    const bodyLower = new THREE.Mesh(new THREE.SphereGeometry(0.25, 16, 16), mat);
    bodyLower.position.y = 0.2;
    group.add(bodyLower);

    const bodyUpper = new THREE.Mesh(new THREE.SphereGeometry(0.24, 16, 16), mat);
    bodyUpper.position.y = 0.4;
    group.add(bodyUpper);

    // Kafa (K√ºre)
    const head = new THREE.Mesh(new THREE.SphereGeometry(0.28, 16, 16), mat);
    head.position.set(0, 0.65, 0.05);
    group.add(head);

    // Kulaklar
    const earGeo = new THREE.ConeGeometry(0.08, 0.18, 4);
    const eL = new THREE.Mesh(earGeo, mat); eL.position.set(0.12, 0.85, 0.05); group.add(eL);
    const eR = eL.clone(); eR.position.x = -0.12; group.add(eR);

    // G√∂zler
    const eyeGeo = new THREE.SphereGeometry(0.04, 8, 8);
    const eyeMat = new THREE.MeshBasicMaterial({ color: eyeColor });
    const eyeL = new THREE.Mesh(eyeGeo, eyeMat); eyeL.position.set(0.1, 0.7, 0.28); group.add(eyeL);
    const eyeR = eyeL.clone(); eyeR.position.x = -0.1; group.add(eyeR);

    // Bacaklar
    const legGeo = new THREE.SphereGeometry(0.08, 8, 8);
    for(let i=0; i<4; i++) {
        const leg = new THREE.Mesh(legGeo, mat);
        leg.position.set(i % 2 ? 0.15 : -0.15, 0.08, i < 2 ? 0.15 : -0.15);
        group.add(leg);
    }

    if(name) {
        const el = document.createElement('div'); el.className = 'label'; el.textContent = name;
        document.body.appendChild(el); group.userData.label = el;
    }
    return group;
}

function setup() {
    phase = "play";
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x020205);
    scene.fog = new THREE.Fog(0x020205, 5, 45);

    camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 1000);
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    scene.add(new THREE.AmbientLight(0xffffff, 2));
    const sun = new THREE.DirectionalLight(0xffffff, 1.2); sun.position.set(5, 10, 5); scene.add(sun);

    // PATƒ∞KA (X geni≈üliƒüi 6 birim)
    path = new THREE.Mesh(new THREE.BoxGeometry(6, 0.1, 200), new THREE.MeshStandardMaterial({color: 0xffffff}));
    path.position.set(0, -0.05, -90); scene.add(path);

    chruno33 = createPerfectCat(0xffa500, 0x331100, "chruno33");
    elfexxel = createPerfectCat(0x111111, 0x00ff00, "elfexxel"); // Elfexxel ye≈üil g√∂zl√º
    elfexxel.visible = false;
    scene.add(chruno33, elfexxel);

    // G√úLLER (Sadece patika i√ßinde: x: -2.5 to 2.5)
    const cols = [0xff0000, 0x800080, 0x111111];
    for(let i=0; i<35; i++) {
        const r = new THREE.Mesh(new THREE.SphereGeometry(0.18), new THREE.MeshStandardMaterial({color: cols[i%3]}));
        r.position.set((Math.random()-0.5)*5, 0.2, -i*5.5 - 20);
        scene.add(r); roses.push(r);
    }

    // BUKET
    bouquet = new THREE.Group();
    const c = new THREE.Mesh(new THREE.ConeGeometry(0.1, 0.35), new THREE.MeshStandardMaterial({color: 0x4d2600}));
    c.rotation.x = Math.PI; bouquet.add(c);
    for(let i=0; i<5; i++) {
        const f = new THREE.Mesh(new THREE.SphereGeometry(0.07), new THREE.MeshBasicMaterial({color: 0xff0000}));
        f.position.set(Math.random()*0.1-0.05, 0.18, Math.random()*0.1-0.05);
        bouquet.add(f);
    }
    bouquet.visible = false; scene.add(bouquet);

    // Zoom engelleyici buton kontrolleri
    const b = (id, k) => {
        const el = document.getElementById(id);
        el.addEventListener('pointerdown', (e) => { e.preventDefault(); keys[k] = true; });
        el.addEventListener('pointerup', (e) => { e.preventDefault(); keys[k] = false; });
        el.addEventListener('pointerleave', (e) => { e.preventDefault(); keys[k] = false; });
    };
    b('up','up'); b('down','down'); b('left','left'); b('right','right');

    animate();
}

function animate() {
    requestAnimationFrame(animate);
    if(phase === "play") {
        const s = 0.25;
        if(keys.up) chruno33.position.z -= s;
        if(keys.down) chruno33.position.z += s;
        if(keys.left) chruno33.position.x -= s;
        if(keys.right) chruno33.position.x += s;

        chruno33.position.x = Math.max(-2.8, Math.min(2.8, chruno33.position.x));
        chruno33.position.z = Math.max(-195, Math.min(5, chruno33.position.z));

        camera.position.lerp(new THREE.Vector3(chruno33.position.x, 2.8, chruno33.position.z + 6), 0.1);
        camera.lookAt(chruno33.position);

        roses.forEach(r => {
            if(r.visible && chruno33.position.distanceTo(r.position) < 0.75) {
                r.visible = false; collected++;
                document.getElementById('count').innerText = Math.min(33, collected);
            }
        });

        if(collected >= 33 && chruno33.position.z < -190) { phase = "final"; triggerFinal(); }
    } else if(phase === "final") {
        camera.position.lerp(new THREE.Vector3(4, 1.8, -300), 0.03);
        camera.lookAt(0, 1, -300);
    }

    [chruno33, elfexxel].forEach(cat => {
        if(cat.visible && cat.userData.label) {
            const p = cat.position.clone().project(camera);
            cat.userData.label.style.left = (p.x + 1)/2 * window.innerWidth + 'px';
            cat.userData.label.style.top = (-p.y + 1)/2 * window.innerHeight + 'px';
        }
    });
    renderer.render(scene, camera);
}

function triggerFinal() {
    document.getElementById('joy').style.display = 'none';
    path.visible = false;
    
    const sand = new THREE.Mesh(new THREE.PlaneGeometry(100, 40), new THREE.MeshStandardMaterial({color: 0xc2b280}));
    sand.rotation.x = -Math.PI/2; sand.position.set(0, -0.05, -300); scene.add(sand);

    const sea = new THREE.Mesh(new THREE.PlaneGeometry(120, 100), new THREE.MeshStandardMaterial({color: 0x0055ff, transparent: true, opacity: 0.6}));
    sea.rotation.x = -Math.PI/2; sea.position.set(0, -0.1, -360); scene.add(sea);

    chruno33.position.set(0, 0, -295); chruno33.rotation.y = Math.PI;
    elfexxel.position.set(0, 0, -305); elfexxel.visible = true; elfexxel.rotation.y = 0;

    let move = setInterval(() => {
        chruno33.position.z -= 0.05;
        elfexxel.position.z += 0.05;
        
        if(chruno33.position.distanceTo(elfexxel.position) < 1.0) {
            clearInterval(move);
            // KUSURSUZ SARILMA (Ayaƒüa kalkma)
            chruno33.rotation.x = -Math.PI/4; chruno33.position.y = 0.35;
            elfexxel.rotation.x = -Math.PI/4; elfexxel.position.y = 0.35;
            
            bouquet.visible = true; bouquet.position.set(0.4, 0.9, -300);
            
            document.getElementById('final-ui').style.display = 'flex';
            setTimeout(() => document.getElementById('m1').style.opacity = 1, 500);
            setTimeout(() => document.getElementById('m2').style.opacity = 1, 2000);
            setTimeout(() => document.getElementById('m3').style.opacity = 1, 4000);
        }
    }, 30);
}
</script>
</body>
</html>
